- name: Reporte consolidado de recursos de las VMs
  hosts: lab
  gather_facts: yes
  become: no # No es necesario para recolectar esta informaci√≥n

  tasks:
    - name: Obtener tiempo de actividad (uptime) en formato legible
      ansible.builtin.command: uptime -p
      register: uptime_result
      changed_when: false # Este comando no realiza cambios

    - name: Mostrar reporte de recursos consolidado
      vars:
        # Filtramos los facts de los puntos de montaje para encontrar la ra√≠z "/"
        root_mount: "{{ ansible_mounts | selectattr('mount', 'equalto', '/') | first }}"
      ansible.builtin.debug:
        msg: |
          
          =======================================
          üìä Reporte de Recursos para: {{ inventory_hostname }}
          =======================================
          
          üñ•Ô∏è  CPU
              Cores: {{ ansible_processor_cores }}
              vCPUs: {{ ansible_processor_vcpus }}
              Modelo: {{ ansible_processor[2] }}

          üß†  Memoria
              Total: {{ ansible_memtotal_mb }} MB
              Libre: {{ ansible_memfree_mb }} MB
              Usada: {{ ansible_memtotal_mb - ansible_memfree_mb }} MB

          üíæ  Disco (/)
              Dispositivo: {{ root_mount.device }}
              Tama√±o Total: {{ (root_mount.size_total / (1024*1024*1024)) | round(1) }} GB
              Espacio Disponible: {{ (root_mount.size_available / (1024*1024*1024)) | round(1) }} GB

          ‚è±Ô∏è  Tiempo de Actividad
              {{ uptime_result.stdout }}

